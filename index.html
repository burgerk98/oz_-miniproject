<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë°°ë¼ ì•„ì´ìŠ¤í¬ë¦¼ í€´ì¦ˆ!</title>
    <link rel="stylesheet" href="/css/index.css" />
    <link rel="stylesheet" href="/css/reset.css" />
  </head>
  <body>
    <div id="container">
      <div class="page">
        <p id="startTitle">ğŸ¦ë°°ë¼ ì•„ì´ìŠ¤í¬ë¦¼ í€´ì¦ˆ!ğŸ¦</p>
        <img src="/img/logo.svg" />
        <button class="btn-15" id="startBtn">í…ŒìŠ¤íŠ¸ ì‹œì‘í•˜ê¸°</button>

        <p id="Participants">
          ì´ ì°¸ì—¬í•œ ì‚¬ëŒ ìˆ˜ : <span id="participantCount">0</span>
        </p>
        <div class="footer">
          Â© 2024. <a href="https://ozcodingschool.com/" target="_blank">ozcodingschool</a>. Mini project. Developed by <a href="#">[ê°•ê³„ë ¹, ë³€ê²½ì›, ì¥ì„¸ë¼]</a>.
        </div>
      </div>
    </div>

    <script src="js/index.js"></script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-analytics.js";
      import {
        getFirestore,
        doc,
        setDoc,
        getDoc,
        updateDoc,
        increment,
      } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyBjQYsdLSevNNOS1jTywn1aAHv3B1jvnDk",
        authDomain: "oz-miniproject-24f85.firebaseapp.com",
        projectId: "oz-miniproject-24f85",
        storageBucket: "oz-miniproject-24f85.appspot.com",
        messagingSenderId: "194531623339",
        appId: "1:194531623339:web:8d8cc72eb81007415d12ee",
        measurementId: "G-Q7HCCQBHY9",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      var startBtn = document.getElementById("startBtn");
      var participantCount = document.getElementById("participantCount");

      // ì°¸ê°€ì ìˆ˜ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
      async function updateParticipantCount(db) {
        const countRef = doc(db, "participants", "counter");

        try {
          // ì°¸ê°€ì ìˆ˜ë¥¼ ê°€ì ¸ì˜¨ë‹¤
          const docSnap = await getDoc(countRef);

          if (docSnap.exists()) {
            // ë¬¸ì„œê°€ ì¡´ì¬í•˜ë©´ ì°¸ê°€ì ìˆ˜ë¥¼ 1ë§Œí¼ ì¦ê°€
            await updateDoc(countRef, {
              count: increment(1),
            });
          } else {
            // ë¬¸ì„œê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ìƒˆë¡œ ë§Œë“¤ê³ , ì°¸ê°€ì ìˆ˜ë¥¼ 1ë¡œ ì„¤ì •
            await setDoc(countRef, {
              count: 1,
            });
          }
        } catch (error) {
          console.error("Error updating participant count: ", error);
        }
      }

      async function displayParticipantCount(db) {
        const countRef = doc(db, "participants", "counter");

        try {
          const docSnap = await getDoc(countRef);
          if (docSnap.exists()) {
            participantCount.innerText = docSnap.data().count;
          } else {
            participantCount.innerText = 0;
          }
        } catch (error) {
          console.error("Error fetching participant count: ", error);
        }
      }

      startBtn.addEventListener("click",async function () {
        await updateParticipantCount(db);
        location.href = "/html/icecreamPage.html";
      });

      window.onload = function () {
        displayParticipantCount(db);
      };
    </script>
  </body>
</html>
